---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: multikubernetesclusterplacements.orchestra.multicluster.x-k8s.io
spec:
  group: orchestra.multicluster.x-k8s.io
  names:
    kind: MultiKubernetesClusterPlacement
    listKind: MultiKubernetesClusterPlacementList
    plural: multikubernetesclusterplacements
    singular: multikubernetesclusterplacement
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: MultiKubernetesClusterPlacement is the Schema for the multikubernetesclusterplacements
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: MultiKubernetesClusterPlacementSpec defines the desired state
              of MultiKubernetesClusterPlacement
            properties:
              affinity:
                description: |-
                  Affinity defines cluster affinity scheduling eligibility rules.
                  If Affinity is nil, the workload will be eligible to be scheduled on all available clusters.
                properties:
                  clusterAffinity:
                    description: ClusterAffinity is a group of cluster affinity scheduling
                      rules.
                    properties:
                      requiredDuringSchedulingIgnoredDuringExecution:
                        description: |-
                          RequiredDuringSchedulingIgnoredDuringExecution defines cluster selector terms that must be met for a cluster to be selected.
                          Existing workloads will not be removed from clusters that no longer meet these requirements.
                        properties:
                          clusterSelectorTerms:
                            description: |-
                              A list of cluster selector terms. The terms are ORed (the workload can be
                              scheduled onto any cluster that fulfills the requirements of at least one
                              term).
                            items:
                              description: A cluster selector term defines a set of
                                requirements for a cluster to be selected.
                              properties:
                                matchExpressions:
                                  description: |-
                                    A list of selector requirements. The requirements are ANDed (all
                                    requirements must be met).
                                  items:
                                    description: |-
                                      A cluster selector expression which contains a selector for either a label or a field.
                                      If both are present, they are ANDed (i.e. both must be met).
                                    properties:
                                      fieldSelector:
                                        description: A field selector requirement.
                                        properties:
                                          field:
                                            description: |-
                                              Field is the ClusterProfile field that the selector applies to. Supported
                                              fields are metadata.name and metadata.namespace.
                                            type: string
                                          operator:
                                            description: |-
                                              Operator represents a field's relationship to a set of values.
                                              Valid operators are In, NotIn, Exists and DoesNotExist.
                                            type: string
                                          values:
                                            description: |-
                                              Values is an array of string values. If the operator is In or NotIn,
                                              the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                              the values array must be empty.
                                            items:
                                              type: string
                                            type: array
                                        required:
                                        - field
                                        - operator
                                        type: object
                                      labelSelector:
                                        description: A label selector requirement.
                                        properties:
                                          key:
                                            description: Key is the label key that
                                              the selector applies to.
                                            type: string
                                          operator:
                                            description: |-
                                              Operator represents a key's relationship to a set of values.
                                              Valid operators are In, NotIn, Exists and DoesNotExist.
                                            type: string
                                          values:
                                            description: |-
                                              Values is an array of string values. If the operator is In or NotIn,
                                              the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                              the values array must be empty.
                                            items:
                                              type: string
                                            type: array
                                        required:
                                        - key
                                        - operator
                                        type: object
                                    type: object
                                  type: array
                              type: object
                            type: array
                        required:
                        - clusterSelectorTerms
                        type: object
                      requiredDuringSchedulingRequiredDuringExecution:
                        description: |-
                          RequiredDuringSchedulingRequiredDuringExecution defines cluster selector terms that must be met for a cluster to be selected.
                          Workloads will be removed from clusters that no longer meet these requirements.
                        properties:
                          clusterSelectorTerms:
                            description: |-
                              A list of cluster selector terms. The terms are ORed (the workload can be
                              scheduled onto any cluster that fulfills the requirements of at least one
                              term).
                            items:
                              description: A cluster selector term defines a set of
                                requirements for a cluster to be selected.
                              properties:
                                matchExpressions:
                                  description: |-
                                    A list of selector requirements. The requirements are ANDed (all
                                    requirements must be met).
                                  items:
                                    description: |-
                                      A cluster selector expression which contains a selector for either a label or a field.
                                      If both are present, they are ANDed (i.e. both must be met).
                                    properties:
                                      fieldSelector:
                                        description: A field selector requirement.
                                        properties:
                                          field:
                                            description: |-
                                              Field is the ClusterProfile field that the selector applies to. Supported
                                              fields are metadata.name and metadata.namespace.
                                            type: string
                                          operator:
                                            description: |-
                                              Operator represents a field's relationship to a set of values.
                                              Valid operators are In, NotIn, Exists and DoesNotExist.
                                            type: string
                                          values:
                                            description: |-
                                              Values is an array of string values. If the operator is In or NotIn,
                                              the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                              the values array must be empty.
                                            items:
                                              type: string
                                            type: array
                                        required:
                                        - field
                                        - operator
                                        type: object
                                      labelSelector:
                                        description: A label selector requirement.
                                        properties:
                                          key:
                                            description: Key is the label key that
                                              the selector applies to.
                                            type: string
                                          operator:
                                            description: |-
                                              Operator represents a key's relationship to a set of values.
                                              Valid operators are In, NotIn, Exists and DoesNotExist.
                                            type: string
                                          values:
                                            description: |-
                                              Values is an array of string values. If the operator is In or NotIn,
                                              the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                              the values array must be empty.
                                            items:
                                              type: string
                                            type: array
                                        required:
                                        - key
                                        - operator
                                        type: object
                                    type: object
                                  type: array
                              type: object
                            type: array
                        required:
                        - clusterSelectorTerms
                        type: object
                    type: object
                    x-kubernetes-validations:
                    - message: Only one of requiredDuringSchedulingRequiredDuringExecution
                        or requiredDuringSchedulingIgnoredDuringExecution may be set
                      rule: (has(self.requiredDuringSchedulingRequiredDuringExecution)
                        && !has(self.requiredDuringSchedulingIgnoredDuringExecution))
                        || (!has(self.requiredDuringSchedulingRequiredDuringExecution)
                        && has(self.requiredDuringSchedulingIgnoredDuringExecution))
                type: object
              scaling:
                description: |-
                  Scaling defines the scaling configuration of the placement. If not specified,
                  the placement will use all eligible clusters.
                properties:
                  autoscaleForCapacity:
                    description: AutoscaleForCapacity defines the configuration for
                      scaling based on ability to obtain capacity.
                    properties:
                      maxClusters:
                        description: |-
                          MaxClusters defines the maximum number of clusters that can be used to
                          run the workload. If zero or not specified, no maximum is enforced.
                        type: integer
                      minClustersBelowCapacityCeiling:
                        description: |-
                          MinClustersBelowCapacityCeiling defines the minimum required number of
                          clusters that are both currently active and able to scale up.
                        minimum: 1
                        type: integer
                      useDraining:
                        description: |-
                          Indicates that the controller should assume clusters in the SCALING_IN
                          state will be proactively drained by a draining system.
                        type: boolean
                      workloadDetails:
                        description: |-
                          WorkloadDetails describes the deployment which is being autoscaled as
                          part of the workload. This information is used to query metrics from each
                          target cluster about the deployment's current ability to scale up/down on
                          that cluster.
                        properties:
                          deploymentName:
                            description: DeploymentName is the name of the deployment
                              to be placed.
                            type: string
                          hpaName:
                            description: HPAName is the name of the HPA to be placed.
                            type: string
                          namespace:
                            description: Namespace is the namespace of the workload
                              to be placed.
                            type: string
                        required:
                        - deploymentName
                        - hpaName
                        type: object
                    required:
                    - minClustersBelowCapacityCeiling
                    type: object
                type: object
            type: object
          status:
            description: MultiKubernetesClusterPlacementStatus defines the observed
              state of MultiKubernetesClusterPlacement
            properties:
              clusters:
                description: Clusters is the list of clusters consumed by the workload
                  delivery system
                items:
                  description: |-
                    PlacementCluster describes a cluster on which the workload should be placed.
                    This is consumed by workload delivery systems.
                  properties:
                    atCapacityCeiling:
                      description: 'Whether the cluster is currently at its capacity
                        ceiling. For informational/debugging purposes only. TODO:
                        remove this'
                      type: boolean
                    draining:
                      properties:
                        currentReplicaCount:
                          description: 'For informational/debugging purposes only.
                            TODO: remove this'
                          type: integer
                        desiredMaxReplicas:
                          description: |-
                            Desired maximum replicas for a draining cluster. The drainer plugin should
                            reconcile the HPA's max replicas field to this value.
                          type: integer
                        lastReplicaCountDecrease:
                          description: The last time DesiredMaxReplicas was decreased.
                          format: date-time
                          type: string
                      required:
                      - desiredMaxReplicas
                      - lastReplicaCountDecrease
                      type: object
                    lastTransitionTime:
                      format: date-time
                      type: string
                    name:
                      type: string
                    namespace:
                      type: string
                    state:
                      enum:
                      - ACTIVE
                      - SCALING_IN
                      - UNHEALTHY
                      - EVICTING
                      type: string
                  required:
                  - lastTransitionTime
                  - name
                  - state
                  type: object
                type: array
              lastAdditionTime:
                format: date-time
                type: string
              lastClusterRemovalTime:
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
